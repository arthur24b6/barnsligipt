<!DOCTYPE html>
<html>
  <head>
    <title>Javascript Image Gallery</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script type="text/javascript" src="/js/exif.js"></script>

    <style>
      #content {
      }
      .thumbnail {
        height: auto;
        border: 1px solid black;
        margin: 10px;
        padding: 20px;
        float: left;
      }
    </style>

    <script>

/**
 * Application settings.
 */
var settings = {
  contentDirectory: 'images/',
  baseURL: '/',
  imagesPerPage: 5
};

/**
 * Utility function to return a path based on the instalation location.
 *
 * @param string path
 *   Create a URL to this path.
 * @returns string
 */
function url(path) {
  return settings.baseURL + path;
}

      $(document).ready(function() {

/**
 * Get all the posts in the specified directory.
 *
 * @TODO handle directories.
 *
 * @returns array of post URIs
 */
function getImageListing() {
  var images = {};
  // Get the directory listing. Note that the sorting is being done by Apache's
  // list options. If this isn't supported on the server this won't work.
  $.ajax({url: url(settings.contentDirectory), async: false})
    .done(function(data) {
      var items = $(data).find('a');
      $(items).each(function(index, value) {
        // Apache writes the URLs relative to the directory.
        var uri = url(settings.contentDirectory) + $(this).attr('href');
        var extension = uri.substr((~-uri.lastIndexOf(".") >>> 0) + 2);
        // Only support jpeg/jpg file extensions.
        if (/\.jpe?g?$/i.test ($(this).attr('href'))) {
          images[index] = uri;
        }
      });
    });
  return images;
}

/**
 * Process a list of image URLs into image elements.
 *
 * @TODO handle pagination.
 * @TODO template.
 *
 * @param array images
 */
function insertImages(images) {
  $.each(images, function(index, src) {
    if (index <= settings.imagesPerPage) {
      var element = $('<a href="' + src +'"></a>');
      var ep = new ExifProcessor(src);
      ep.execute(generateThumb(element, src));

      var wrapper = $('<div class="thumbnail">');
      element.prependTo(wrapper);
      $(wrapper).prependTo('#content');

      $('a', wrapper).click(function() {
        // Handle full element load.
        console.log('click');
        return false;
      });
    }
    else {
      return false;
    }
  });
}

  // Run the application.
  var images = getImageListing();
  insertImages(images);

});
    </script>
  </head>
  <body>
    <div id="content"></div>
  </body>
</html>
